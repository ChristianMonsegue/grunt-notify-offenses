

<h1>{{pageHeader}}</h1>

<div class="row-fluid">&nbsp;</div>

<ul class="nav nav-pills">
    <li>
        <a href="/EHR/#/billing/remittance-manager" class="current">Remittance Manager</a>
    </li>
    <li class="active">
        <a href="/EHR/#/billing/remittance/{{remittanceLink}}">{{pageHeader}}</a>
    </li>
</ul>
<div class="requiredContainer right" style="text-align: right">
  <label>
	<span style="font-weight: bold;">*Required</span>
  </label>
</div>
<div class="row-fluid">&nbsp;</div>
<div class="bootstrap formContainer kinnser-well-blue">
    <div class="ux-forms">
        <form id="remittanceEdit" name="remittanceEdit" ng-submit="Submit()" class="form-horizontal">

			<div class="row-fluid">
                <div class="span6">
                    <div class="control-group">
                        <label class="control-label v-required" for="remittanceDate">Remittance Date:</label>
                        <div class="controls">
                            <input data-k-date-picker
                            	name        = "remittanceDate"
                            	id          = "remittanceDate"
                                type        = "text"
                            	ng-model    = "remittance.remittanceDate"
                                ng-disabled = "viewonly"
                            	class       = "validate[required]"/>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label v-required" for="referenceNumber">Remittance #:</label>
                        <div class="controls">
                            <input data-k-alpha-numeric-input
                                type        = "text"
                            	name        = "referenceNumber"
                            	id          = "referenceNumber"
                            	ng-model    = "remittance.referenceNumber"
                                ng-disabled = "viewonly"
                            	class       = "validate[required]" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label v-required" for="insurance">Insurance:</label>
                        <div class="controls">
                            <insurance-dropdown
                                name          = "insurance"
                                id            = "insurance"
                                insurance-key = "remittance.insuranceKey"
                                class         = "validate[required]"
                                is-disabled   = "viewonly|| hasActiveClaims()"
                                ng-disabled   = "isDisabled"
                                ng-change     = "reset()">
                            </insurance-dropdown>
                        </div>
                    </div>
                </div>

                <div class="span6">
                    <div class="control-group">
					 <label class="control-label v-required" for="remittanceAmount">Check Total:</label>
					  <div class="controls">
                            $<input data-k-currency-input
                                type        = "text"
                            	name        = "remittanceAmount"
                            	id          = "remittanceAmount"
                            	ng-model    = "remittance.remittanceAmount"
                                ng-disabled = "viewonly"
                            	class       = "validate[required,maxSize[14]" />
                      </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label" for="reimbursementTotal">Reimbursement Total:</label>

                        <div class="controls" id="reimbursementTotal">
                            {{remittance.reimbursementTotal | currency}}
                        </div>
                        <br/>
                        <label class="control-label" for="balance" >Balance:</label>

                        <div class="controls" id="balance">
                            {{remittance.balance | currency}}
                        </div>
                    </div>

                </div>
            </div>

<!-- ------------ Claims ------------------ -->
            <div class="control-group">
                <button
                    id          = "addClaimsButton"
                    type        = "button"
                    class       = "btn "
                    ng-click    = "addClaim( )"
                    ng-disabled = "!remittance.insuranceKey || viewonly"
                    ui-if       = "!viewonly" >

                    Add Claims

                </button>
            </div>

 
        <div class="control-group" ng-repeat="claim in remittance.claims | orderBy: 'claimTransactionKey'" ng-show="claim.active">
                <table style="width: 100%; background: rgb( 234, 234, 234 );border-bottom: 2px solid rgb( 243, 243, 243 );">
                    <tbody>
                        <tr>
                    		<td><i 
                                type        = "button" 
                                ng-click    = "showClaimDetails( claim )" 
                                class       = "icon-folder-close"
                                ng-show     = "!claim.showDetails" />
								<i 
                                type        = "button" 
                                ng-click    = "hideClaimDetails( claim )" 
                                class       = "icon-folder-open"
                                ng-show     = "claim.showDetails" />
							</td>
                            <td style="width: 100px; padding: 5px;">
                                Claim Number</td>
                            <td style="padding: 5px;">
                                <input 
                                    type     = "text" 
                                    class    = "input-small" 
                                    ng-model = "claim.claimTransactionKey"
                                    disabled />
                            </td>
                            <td style="width: 75px; text-align: right;  padding: 5px;">Patient Name</td>
                            <td style="padding: 5px;">
                                <input 
                                    type     = "text" 
                                    class    = "input-xlarge" 
                                    ng-model = "claim.patientName"
                                    disabled />
                            </td>
                            <td style="text-align: right; padding: 5px;">Net Reimbursement Amt</td>
                            <td style="padding: 5px;">
                                <input data-k-currency-input
                                    type     = "text" 
                                    class    = "input-small" 
                                    ng-model = "claim.claimAmount"
                                    disabled  />
                            </td>
                            <td style="text-align: right;"><i ng-show="!viewonly" class="icon-trash" ng-click="removeClaim( claim )" /></td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
		</table>
			<div ng-model="remittance.claims[ claim ]" k-claims viewonly="{{viewonly}}" ng-show="claim.active" ui-if="claim.loadClaim"/>
		</div>
		
		
		
<!-- -------------------------------------- -->

            <div class="row-fluid">
                <div class="span3 control-label">Remittance Comments:</div>

                <div ng-pluralize
                    class = "span3 offset6 pull-right"
                	count = "500 - remittance.comment.length"
                	when  = "{'0': 'No characters remaining!', 'one' : 'Remaining Character: {}', 'other' : 'Remaining Characters: {}'}">
                </div>
            </div>

            <div class="row-fluid">
                <textarea
                    id          = "comment"
                    name        = "comment"
                    class       = "span12"
                    ng-model    = "remittance.comment"
                    ng-disabled = "viewonly"
                    placeholder = "enter text..."
                    rows        = "4" />
            </div>

            <div class="row-fluid">&nbsp;</div>

			<div class="row-fluid">
                <div class="control-group">
                    <div class="controls" style="text-align: right" ui-if="!viewonly">
                        <input
                            id       = "cancelButton"
                            type     = "button"
                            class    = "btn"
                            value    = "Cancel"
                            ng-click = "cancel( )" />
                        <input
                            id       = "saveButton"
                            type     = "submit"
                            value    = "Save"
                            class    = "btn"
                            ng-click = "saveAction('save')" />
                        <input
                            id       = "completeButton"
                            type     = "submit"
                            value    = "Save and Complete"
                            class    = "btn"
                            ng-click = "saveAction('complete')" />
    				</div>
                 </div>
			</div>

        </form>
   </div>
<!-- {{remittance|json}} -->
</div>

<!-- Attachment -->
<div class="row-fluid"><b>Attachments</b></div>
<div key="remittance.remittanceKey" atype="Remittance" clinic="clinickey" k-attachment />

<!-- Add Claim Modal -->
<div id="addClaimToPaymentDialog" class="modal hide">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    	<div class="modal-header-inner" style="background-image: none; background-color: transparent; height: 30px;">
            <hgroup>
                <h3><b>Add Claim:  </b></h3>
            </hgroup>
    	</div>
    </div>
    <div class="modal-body ux-forms">
		<form id="addClaims" name="addClaims" class="form-horizontal" ng-submit="search( )">
			<div class="control-group" style="margin-bottom: 0;">
				<label class="control-label" for="inputPatientLast">
					<span rel="tooltip" data-original-title="Searches for all patients with claims under that insurer or parent insurer.">Patient</span>
				</label>
				<div class="controls controls-row">
					<input type="text" id="inputPatientLast" placeholder="Last" ng-model="params.patient.name.last" style="padding: 0 5px;" />,
					<input type="text" id="inputPatientFirst" placeholder="First" ng-model="params.patient.name.first" style="padding: 0 5px;" />
				</div>
			</div>
			<div class="control-group" style="margin-bottom: 0;">
				<label class="control-label" for="inputClaimNumber">
					<span rel="tooltip"  data-original-title="Will search by claim number.">Claim #</span>
				</label>
				<div class="controls">
					<input type="text" id="inputClaimNumber" placeholder="Claim Number" ng-model="params.claim.claimTransactionKey" style="padding: 0 5px;" />
				</div>
			</div>
			<div class="control-group" style="margin-bottom: 0;">
				<label class="control-label" for="inputClaimDate">
					<span rel="tooltip" data-original-title="Find all claims with that claim date.">Claim Date</span>
				</label>
				<div class="controls" style="margin-bottom: 0px;">
					<input data-k-date-picker
                        type     = "text"
						id       = "inputClaimDate"
						class    = "input-small"
						ng-model = "params.claim.date"
						style    = "padding: 0 5px;" />
				</div>
			</div>
			<div class="control-group" style="margin-bottom: 0;">
				<label class="control-label" for="inputServiceDateRangeStart">
					<span rel="tooltip" data-original-title="Will find all claims that have line items with services dates between the start and end date.">Service Date Range</span>
				</label>
				<div class="controls controls-row" style="margin-bottom: 0px;">
					<input data-k-date-picker
                        type     = "text"
						id       = "inputServiceDateRangeStart"
						class    = "input-small"
						ng-model = "params.range.start"
						style    = "padding: 0 5px;" />

					<i class="icon-minus"></i>

					<input data-k-date-picker
                        type     = "text"
						id       = "inputServiceDateRangeEnd"
						class    = "input-small"
						ng-model = "params.range.end"
						style    = "padding: 0 5px;" />
				</div>
			</div>
			<div class="control-group" style="margin-bottom: 0;">
				<div class="controls">
					<input
                        type        = "submit"
						id          = "search"
						name        = "search"
						class       = "btn"
						value       = "Search"
						ng-disabled = "(!params.patient.name.last
										&& !params.patient.name.first
										&& !params.claim.claimTransactionKey
										&& !params.claim.date
										&& !params.range.start
										&& !params.range.end)"
                        data-loading-text = "Searching..." />
					<button type="button" class="btn" value="Reset" ng-click="reset( )">Reset</button>
				</div>
			</div>
		</form>
		<div class="gridStyle" ng-grid="addClaimsGrid" ng-show="addClaims"></div>
		<div id="popover"></div>

        <div ng-hide="true">
			<div k-line-items id="lineItems" items="lineItems"></div>
		</div>

    </div>
    <div class="modal-footer">
		<button id="doneBtn" class="btn" ng-click="done( )">Done</button>
    </div>
</div>
